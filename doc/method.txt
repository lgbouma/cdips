get files needed before subtraction:

  1. run a source extraction on all the frames to get positions of
     bright stars.
  2. using those positions, get astrometric solution for each frame.
     (AKA: WCS headers).
  3. project a background catalog onto the frame, e.g., 2MASS, or
     Gaia, using the astrometric solution.
  (4. reform the catalog to work with the expected format, and to
      lessen overhead).
  5. run photometry on all frames to get initial, non-image subtracted
     fluxes.

image subtraction:

  1. bookkeep all info above into a postgres database (for future
     extraction / reference)
  2. using the info collected in the postgres database (e.g., median
     background, median SDK values), select an astrometric reference
     frame. this frame has sharp and round stars.
  3. generate files that contain the smoothed S, D, K coefficients
     for each source detection list. this is needed later when we do
     photometry on the subtracted frames.
  4. calculate the X and Y coordinate shifts between the selected
     astrometric reference and all other frames we're working on. then
     shift these other frames to the coordinate system of the
     astrometric reference, so that the frames will subtract cleanly.
  5. select frames to serve as photometric reference candidates 
  6. make the photometric reference frame
  7. convolve and subtract all the frames that have been translated
     (the xtrns list) from the photometric reference.
  8. do aperture photometry on subtracted frames to produce .iphot
     files.
  9. transpose, by dumping with grcollect 

detrending:

  1. do EPD on all the LCs, and collect stats on the results. 

  2. do TFA on all the LCs.
      * First, choose TFA template stars using the .epdlc stats.
      * Then run TFA for each aperture
      * Then collect statistics.

  3. optionally, bin lightcurves (1hr, 6hr). collect similar statistics.

  4. assess how run went:
     * make MAD vs mag plots.
     * whisker plots.
     * how long did the pipeline take?
     * make MOVIES of subtracted frames.
     * are their statistics gaussian?
